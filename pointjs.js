function PointJS(a,b,d,e){"use strict";var f=this,g=function(){console.log("function is not supported in this object")},h=true,i=false,j=true,k=false,l=false,m=b,n=d,o=b,p=d,q=m/2,r=n/2,s={x:0,y:0},t=0,u={x:0,y:0},v={fillStyle:"black",strokeStyle:"black",globalAlpha:1,font:"sans-serif",textBaseline:"top"},w=function(a){console.log("[PointJS] : ",a)},x=function(a){var b=decodeURI(a.stack.toString().replace(/(@|[\(\)]|[\w]+:\/\/)/g,""));b=b.split(/\n/);b=(b[2]==""?b[0]:b[1]).split("/");b=b[b.length-1].split(":");console.log('ERROR "'+a.toString()+'" \n in      '+b[0]+" \n line:   "+b[1]+" \n symbol: "+b[2])},y=function(a,b){w('function "'+a+'" is DEPRECATED, use a "'+b+'"')};this.game={};this.camera={};this.keyControl={};this.mouseControl={};this.touchControl={};this.system={};this.vector={};this.math={};this.colors={};this.brush={};this.audio={};this.wAudio={};this.dialogs={};this.resources={};this.tiles={};this.OOP={};this.system.log=w;this.system.setSettings=function(a){h=Ca(a.isShowError)?a.isShowError:true;j=Ca(a.isStopForError)?a.isStopForError:true;k=Ca(a.isAutoClear)?a.isAutoClear:false;i=Ca(a.isZBuffer)?a.isZBuffer:false};this.system.setDefaultSettings=function(a){for(var b in a)v[b]=a[b]};var z=function(a,b){return{x:a,y:b}},A=function(a,b){return{w:a,h:b}},B=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},C=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},D=function(a,b){return{x:a.x*b.x,y:a.y*b.y}},E=function(a,b){return{x:a.x/(b.x!=0?b.x:1),y:a.y/(b.y!=0?b.y:1)}},F=function(a){return{x:Math.abs(a.x),y:Math.abs(a.y)}},G=function(a,b,c){if(c!=0){var d=N(c);var e=a.x-b.x;var f=a.y-b.y;var g=Math.cos(d);var h=Math.sin(d);return z(e*g-f*h+b.x,e*h+f*g+b.y)}else return z(a.x,a.y)},H=function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)*(180/Math.PI)},I=function(a,b){if(b.length<3)return false;var c=0,d=b.length-1,e=b[d].y<a.y;for(var f=0;f<b.length;++f){var g=b[f].y<a.y;var h=C(b[d],a);var i=C(b[f],a);var j=h.x*(i.y-h.y)-h.y*(i.x-h.x);if(g&&!e)if(j>0)c+=1;if(!g&&e)if(j<0)c+=1;d=f;e=g}return(c&1)!=0},J=function(a,b){if(!Ca(b))return 0;return z((a.x+b.x)/2,(a.y+b.y)/2)},K=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},L=function(a,b){if(!Ca(b))return false;return a.x==b.x&&a.y==b.y};this.vector.point=z;this.vector.v2d=z;this.vector.size=A;this.vector.w2h=A;this.vector.getPointAngle=G;this.vector.isPointIn=I;this.vector.pointMinus=C;this.vector.pointPlus=B;this.vector.pointInc=D;this.vector.pointDiv=E;this.vector.pointAbs=F;this.vector.getMidPoint=J;this.vector.getDistance=K;this.vector.isSame=L;this.vector.getAngle2Points=H;var M=function(a){return a>>0},N=function(a){return a*(Math.PI/180)},O=function(a,b,c){var d=Math.floor(Math.random()*(b-a+1)+a);return c&&d==0?O(a,b,c):d},P=function(a,b){var c=a>0?1:-1,d=b>0?1:-1;a=Math.abs(a);b=Math.abs(b);return a<b?a*c:b*d};this.math.limit=P;this.math.a2r=N;this.math.random=O;this.math.toInt=M;var Q={loaded:false,events:{onload:{},preLoop:{},postLoop:{},gameBlur:{},gameFocus:{},gameResize:{}},addEvent:function(a,b,c){if(a=="onload"&&Q.loaded)c();else Q.events[a][b]=c},delEvent:function(a,b){delete Q.events[a][b]},runEvent:function(a){for(var b in Q.events[a])if(typeof Q.events[a][b]=="function")Q.events[a][b]()},attach:function(a){var b=function(){window.document.body.appendChild(a)};if(Q.loaded)b();else Q.addEvent("onload","attachCanvas_PointJS",b)},getWH:function(){return{w:parseInt(window.document.documentElement.clientWidth)<parseInt(screen.width)?parseInt(window.document.documentElement.clientWidth):parseInt(screen.width),h:parseInt(window.document.documentElement.clientHeight)<parseInt(screen.height)?parseInt(window.document.documentElement.clientHeight):parseInt(screen.height)}}};this.system.delEvent=function(a,b){Q.delEvent(a,b)};this.system.addEvent=function(a,b,c){Q.addEvent(a,b,c)};this.system.attachDOM=function(a){Q.attach(a)};window.document.body.style.overflow="hidden";var R=window.document.createElement("canvas");R.width=parseInt(b);R.height=parseInt(d);R.style.position="fixed";R.style.left=0;R.style.top=0;R.style.zIndex=1000;R.id="PointJS-canvas_0";if(typeof e=="object")for(var S in e)if(!S.match(/margin|padding|position/))R.style[S]=e[S];Q.attach(R);var T={x:parseInt(R.style.left),y:parseInt(R.style.top)},U=R.getContext("2d");this.system.setStyle=function(a){if(typeof a=="object")for(var b in a)R.style[b]=a[b]};this.system.getContext=function(){return U};this.system.resize=function(a,b){m=a||o;n=b||p;q=m/2;r=n/2;R.width=m;R.height=n};this.system.initFullPage=function(){Q.addEvent("gameResize","PointJS_resizeGame",function(){m=Q.getWH().w;n=Q.getWH().h;q=m/2;r=n/2;R.width=m;R.height=n});Q.runEvent("gameResize","PointJS_resizeGame")};this.system.exitFullPage=function(){m=o;n=p;q=m/2;r=n/2;R.width=m;R.height=n};this.system.initFullScale=function(){R.style.width="100%";R.style.height="100%"};this.system.exitFullScale=function(){R.style.width=o+"px";R.style.height=p+"px"};this.system.getWH=function(){return Q.getWH()};var V={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,C:67,"9":57,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},W={"37":"LEFT","39":"RIGHT","38":"UP","40":"DOWN","32":"SPACE","17":"CTRL","16":"SHIFT","18":"ALT","27":"ESC","13":"ENTER","189":"MINUS","187":"PLUS","20":"CAPS_LOCK","8":"BACKSPACE","9":"TAB","81":"Q","87":"W","69":"E","82":"R","84":"T","89":"Y","85":"U","73":"I","79":"O","80":"P","65":"A","83":"S","68":"D","70":"F","71":"G","72":"H","74":"J","75":"K","76":"L","90":"Z","88":"X","86":"V","66":"B","78":"N","77":"M","48":"0","49":"1","50":"2","51":"3","52":"4","53":"5","54":"6","55":"7","56":"8","67":"C","57":"9","112":"F1","113":"F2","114":"F3","115":"F4","116":"F5","117":"F6","118":"F7","119":"F8","120":"F9","121":"F10","122":"F11","123":"F12"},X={"8":true,"9":true,"13":true,"18":true,"16":true,"17":true,"27":true,"112":true,"113":true,"114":true,"115":true,"116":true,"117":true,"118":true,"119":true,"120":true,"121":true,"122":true,"123":true};this.keyControl.getKeyList=function(){var a,b=[];for(a in V)b.push(a);return b};var Y={},Z={},aa={},ba=false,ca=false,da=false,ea=function(a){Y[a]=true},fa=function(a){Fa(aa,function(a,b,c){if(a==1)c[b]=2})},ga=function(a){Y[a]=false},ha=function(){Z={}},ia=function(){Y={};Z={};aa={};ba=false;ca=false};this.keyControl.isDown=function(a){return Y[V[a]]==true};this.keyControl.isUp=function(a){return Z[V[a]]==true};this.keyControl.isPress=function(a){return aa[V[a]]==1};this.keyControl.getInputChar=function(){return ba};this.keyControl.getInputKey=function(){return W[ca]};this.keyControl.setInputMode=function(a){da=a};this.keyControl.isInputMode=function(){return da};this.keyControl.exitKeyControl=function(){window.onkeydown=function(){};window.onkeypress=function(){};window.onkeyup=function(){};Q.delEvent("postLoop","PointJS_clearAllKeyUp");Y={};Z={};aa={};ba=false;ca=false;da=false};this.keyControl.initKeyControl=function(){window.onkeydown=function(a){if(da){ca=a.keyCode;if(X[a.keyCode]){a.preventDefault();return false}return true}a.preventDefault();if(aa[a.keyCode]!=2)aa[a.keyCode]=1;ea(a.keyCode);return false};window.onkeypress=function(a){var b=false;if(a.which!=0&&a.charCode!=0)if(a.which>=32)b=String.fromCharCode(a.which);ba=b};window.onkeyup=function(a){a.preventDefault();if(Y[a.keyCode]==true)Z[a.keyCode]=true;ga(a.keyCode);delete aa[a.keyCode];return false};Q.addEvent("postLoop","PointJS_clearAllKeyUp",function(){ha();fa();ba=false;ca=false})};var ja={pos:z(0,0),oldPos:z(0,0),visible:true,image:"",locked:false,speed:z(0,0)},ka={LEFT:1,RIGHT:3,MIDDLE:2},la={},ma={},na={},oa=0,pa=function(){la={};ma={};na={};oa=0},qa=function(a){var b=0,c=0;if(a){b=s.x;c=s.y}return z(b+ja.pos.x,c+ja.pos.y)};this.mouseControl.getPosition=function(){return qa(1)};this.mouseControl.getPositionS=function(){return qa()};var ra=function(a){window.document.body.style.cursor='url("'+a+'"), auto'};this.mouseControl.setCursorImage=ra;this.mouseControl.setVisible=function(a){if(!ja.visible&&!a||ja.visible&&a)return;ja.visible=a==true;window.document.body.style.cursor=ja.visible?ja.image:"none"};this.mouseControl.isVisivle=function(){return ja.visible};this.mouseControl.isDown=function(a){return la[ka[a]]};this.mouseControl.isUp=function(a){return ma[ka[a]]};this.mouseControl.isPress=function(a){if(!Ca(na[ka[a]])||na[ka[a]]==2)return false;na[ka[a]]=2;return true};this.mouseControl.isInStatic=function(a){var b=qa(1);return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.mouseControl.isInDynamic=function(a){return I(qa(1),a)};this.mouseControl.isInObject=function(a){if(!a.visible)return false;if(!a.angle)return this.isInStatic(a.getStaticBox());else return this.isInDynamic(a.getDynamicBox())};this.mouseControl.isWheel=function(a){return a=="UP"&&oa>0||a=="DOWN"&&oa<0};var sa=function(a){a.preventDefault();oa=a.wheelDelta?a.wheelDelta:-a.detail;return false},ta=function(){ma={}},ua=false,va=function(){if(!ua)return;if(Ca(window.document.pointerLockElement)||Ca(window.document.mozPointerLockElement))ja.locked=true;else ja.locked=false};this.mouseControl.initMouseLock=function(){Q.addEvent("onload","initPointerLock",function(){ua=R.requestPointerLock||R.mozRequestPointerLock||false;window.document.exitPointerLock=window.document.exitPointerLock||window.document.mozExitPointerLock||false;if("onpointerlockchange"in window.document)window.document.addEventListener("pointerlockchange",va,false);else if("onmozpointerlockchange"in window.document)window.document.addEventListener("mozpointerlockchange",va,false);if(!ua)return w("error initMouseLock");if(ja.locked)return;R.onclick=ua})};this.mouseControl.exitMouseLock=function(){window.document.exitPointerLock();R.onclick=function(){};ja.speed=z(0,0)};this.mouseControl.unlockMouse=function(){ja.speed=z(0,0);window.document.exitPointerLock()};this.mouseControl.isMouseLock=function(){return ja.locked};this.mouseControl.getSpeed=function(){if(!ja.speed.x&&!ja.speed.x){ja.speed.x=ja.pos.x;ja.speed.y=ja.pos.y;return v2d()}var a=ja.pos.x-ja.speed.x,b=ja.pos.y-ja.speed.y;ja.speed.x=ja.pos.x;ja.speed.y=ja.pos.y;return v2d(a,b)};this.mouseControl.isPeekStatic=function(a,b){if(!this.isPress(a))return false;return this.isInStatic(b)};this.mouseControl.isPeekDynamic=function(a,b){if(!this.isPress(a))return false;return this.isInDynamic(b)};this.mouseControl.isPeekObject=function(a,b){if(!this.isPress(a)||!b.visible)return false;return this.isInDynamic(b.getDynamicBox())};this.mouseControl.initMouseControl=function(){window.onmousemove=function(a){a.preventDefault();a.stopPropagation();if(ja.locked){var b=a.movementX||a.mozMovementX||0;var c=a.movementY||a.mozMovementY||0;ja.pos.x+=b;ja.pos.y+=c;return false}else{ja.pos.x=a.pageX-T.x;ja.pos.y=a.pageY-T.y}return false};window.onmousedown=function(a){a.preventDefault();a.stopPropagation();if(!a.which&&a.button)if(a.button&1)a.which=1;else if(a.button&4)a.which=2;else if(a.button&2)a.which=3;la[a.which]=true;na[a.which]=na[a.which]!=1?1:false};window.onmouseup=function(a){a.preventDefault();a.stopPropagation();if(!a.which&&a.button)if(a.button&1)a.which=1;else if(a.button&4)a.which=2;else if(a.button&2)a.which=3;la[a.which]=false;ma[a.which]=true;na[a.which]=2};window.oncontextmenu=window.onselectstart=window.ondragstart=function(){return false};window.onmousewheel=sa;window.addEventListener("DOMMouseScroll",sa,false);Q.addEvent("postLoop","PointJS_clearAllMouseUp",function(){ta();oa=0});return this};this.mouseControl.exitMouseControl=function(){window.onmousemove=window.onmousedown=window.onmouseup=window.oncontextmenu=window.onselectstart=window.ondragstart=window.onmousewheel=function(){}};var wa={down:false,press:1,up:1,x:0,y:0,fix:z(0,0),contacts:[]},xa=function(){wa.press=2},ya=function(){wa.down=false;wa.press=1;wa.up=1;wa.fix=z(0,0);wa.contacts=[];wa.x=0;wa.y=0};this.touchControl.getFixPositionS=function(){if(!wa.fix.x&&!wa.fix.y)return false;return z(wa.fix.x,wa.fix.y)};this.touchControl.getFixPosition=function(){if(!wa.fix.x&&!wa.fix.y)return false;return z(wa.fix.x+s.x,wa.fix.y+s.y)};this.touchControl.getRun=function(){var a=0,b=0;if(wa.fix.x&&wa.fix.x!=wa.x)a=wa.x-wa.fix.x;if(wa.fix.y&&wa.fix.y!=wa.y)b=wa.y-wa.fix.y;return z(a,b)};this.touchControl.getVector=function(){var a=0,b=0;if(wa.fix.x&&wa.fix.x!=wa.x)a=wa.x>wa.fix.x?1:-1;if(wa.fix.y&&wa.fix.y!=wa.y)b=wa.y>wa.fix.y?1:-1;return z(a,b)};this.touchControl.isDown=function(){return wa.down};this.touchControl.isPress=function(){return wa.press==1};this.touchControl.isUp=function(){if(wa.up==0){wa.up=1;return true}else return false};this.touchControl.getPosition=function(){return z(wa.x+s.x,wa.y+s.y)};this.touchControl.getPositionS=function(){return z(wa.x,wa.y)};this.touchControl.isPeekStatic=function(a){if(!this.isPress())return false;return this.isInStatic(a)};this.touchControl.isPeekDynamic=function(a){if(!this.isPress())return false;return this.isInDynamic(a)};this.touchControl.isPeekObject=function(a){if(!this.isPress()||!a.visible)return false;return this.isInDynamic(a.getDynamicBox())};this.touchControl.isInStatic=function(a){var b=this.getPosition();return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.touchControl.isInDynamic=function(a){return I(this.getPosition(),a)};this.touchControl.isTouchesInDynamic=function(a){if(wa.contacts.length<1)return false;var b;for(b=0;b<wa.contacts.length;b++)if(I(z(wa.contacts[b].pageX+s.x,wa.contacts[b].pageY+s.y),a))return true;return flase};this.touchControl.isTouchesInStatic=function(a){if(wa.contacts.length<1)return false;var b;for(b=0;b<wa.contacts.length;b++){var c=z(wa.contacts[b].pageX+s.x,wa.contacts[b].pageY+s.y);if(c.x>=a.x&&c.x<=a.x+a.w&&c.y>=a.y&&c.y<=a.y+a.h)return true}return flase};this.touchControl.getTouches=function(){if(wa.contacts.length<1)return false;var a=[],b;for(b=0;b<wa.contacts.length;b++)a.push({screenX:wa.contacts[b].pageX,screenY:wa.contacts[b].pageY,x:wa.contacts[b].pageX+s.x,y:wa.contacts[b].pageY+s.y});return a};this.touchControl.initTouchControl=function(){window.addEventListener("touchstart",function(a){a.preventDefault();wa.x=a.targetTouches[0].pageX;wa.y=a.targetTouches[0].pageY;wa.fix.x=wa.x;wa.fix.y=wa.y;wa.contacts=a.targetTouches;wa.down=true;wa.press=1;return false},true);window.addEventListener("touchmove",function(a){a.preventDefault();wa.x=a.targetTouches[0].pageX;wa.y=a.targetTouches[0].pageY;wa.contacts=a.targetTouches;return false},true);window.addEventListener("touchend",function(a){a.preventDefault();wa.contacts=a.targetTouches;wa.fix.x=0;wa.fix.y=0;wa.down=false;wa.up=0;wa.press=0;return false},true);f.touchControl.vibrate=function(a){if(window.navigator.vibrate)return window.navigator.vibrate(a);if(window.navigator.oVibrate)return window.navigator.oVibrate(a);if(window.navigator.mozVibrate)return window.navigator.mozVibrate(a);if(window.navigator.webkitVibrate)return window.navigator.webkitVibrate(a)};Q.addEvent("postLoop","PointJS_touchStopPress",function(){xa()})};this.touchControl.exitTouchControl=function(){window.ontouchstart=window.ontouchmove=window.ontouchend=function(a){}};var za={name:"PointJS",desc:"2D game engine for JavaScript",author:"Skaner -> skaner0@yandex.ru"};this.system.getInfo=function(){return za};var Aa=function(a,b,c,d){return"rgba("+a+", "+b+", "+c+", "+(d?d:1)+")"},Ba=function(a,b){a=a[0]=="#"?a.substr(1,6):a;var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return Aa(c,d,e,b)};this.colors.linearGradient=function(a,b,c){var d,e=window.document.createElement("canvas");e.width=b;e.height=b;var f=e.getContext("2d");if(a=="horizontal")d=f.createLinearGradient(0,0,0,b);else d=f.createLinearGradient(0,0,b,0);var g=1/(c.length-1),h,i=0;for(h=0;h<=1;h+=g){d.addColorStop(h,Da(c[i])?c[i]:"rgba(255, 255, 255, 0)");i++}f.fillStyle=d;f.fillRect(0,0,b,b);return f.createPattern(e,"repeat")};this.colors.rgb=function(a,b,c){return Aa(a,b,c,1)};this.colors.rgba=function(a,b,c,d){return Aa(a,b,c,d)};this.colors.hex2rgb=function(a){return Ba(a,1)};this.colors.hex2rgba=function(a,b){return Ba(a,b)};this.colors.randomColor=function(a,b,c){return Aa(O(a,b),O(a,b),O(a,b),c||1)};var Ca=function(a){if(typeof a=="undefined"||a==null)return false;return true},Da=function(a){if(!Ca(a)||a===""||a===0)return false;return true},Ea=function(a,b){var c,d=0,e,f="[";for(c in a){e=a[c];if(typeof e=="number"&&b)e=parseInt(e);f+=(d>0?", ":"")+c+" : "+e;d++}return f+"]"},Fa=function(a,b){var c;for(c in a)b(a[c],c,a)},Ga=function(a,b){if(a.length==0)return;var c;for(c=0;c<a.length;c++)b(a[c],c,a)},Ha=function(a,b){var c;for(c=0;c<a;c++)b(c)},Ia=function(a,b,c){var d,e;for(e=0;e<b;e++)for(d=0;d<a;d++)c(d,e)},Ja=function(a){return a[O(0,a.length)]},Ka=function(a){var b={},c=new XMLHttpRequest;c.open("GET",a,false);c.send();b=c.responseText;b=JSON.parse(b);return b},La=function(a,b){var c={},d=new XMLHttpRequest;d.open("GET",a,true);bc.add();d.onreadystatechange=function(){if(d.readyState==4){c=d.responseText;c=JSON.parse(c);bc.load();b(c)}};d.send()};this.OOP.readJSON=La;this.OOP.toString=Ea;this.OOP.isDef=Ca;this.OOP.isSet=Da;this.OOP.forEach=Fa;this.OOP.forInt=Ha;this.OOP.forXY=Ia;this.OOP.forArr=Ga;this.OOP.randArrElement=Ja;this.OOP.readJSONSync=Ka;var Ma=60,Na=0,Oa=0,Pa=-1,Qa=0,Ra={},Sa=function(a){Ma=a},Ta=function(){return 0};this.game.getDT=function(a){a=a||1000;return Oa/a};this.game.getTime=function(){return Na};var Ua=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1000/Ma)}},Va=Ua(),Wa=function(){Na=Date.now();if(k)Db(z(0,0),z(m,n));Q.runEvent("preLoop")},Xa=function(){Q.runEvent("postLoop");if(Pa!=-1)Oa=Na-Pa;Pa=Na},Ya={func:function(){console.log('please, use a "setLoop" function.');Va=function(){}},start:false,end:false,audio:false},Za=function(){if(!Ya.audio)return;var a;for(a in Ya.audio)Ya.audio[a].stop()},ab=function(){if(!Ya.audio)return;Ya.audio[0].play()};this.game.newLoop=function(a,b){if(typeof b=="function")Ra[a]={func:b,start:false,end:false,audio:false};else db("error im newLoop")};this.game.setLoopSound=function(a,b){var c;if(!Ra[a].audio)Ra[a].audio=[];for(c=0;c<b.length;c++){b[c].setNextPlay(b[c+1==b.length?0:c+1]);Ra[a].audio.push(b[c])}};this.game.setLoop=function(a){if(!Ra[a])return w("setLoop: "+a+" is no a Loop");Za();pa();ia();ya();Ab(z(0,0));Ya=Ra[a];ab()};var bb=function(){try{Wa();Ya.func();Xa()}catch(a){if(h)x(a);if(j){if(!h)x(a);db()}}Va(bb)},cb=function(a){if(l)return;l=true;Sa(a||60);Va(bb)},db=function(a){if(!l)return;l=false;Za();Va=function(){w(a||"game is stop")}},eb=function(a){if(l)return;ab();w(a||"game is run");Va=Ua();Pa=-1;cb(Ma);return};this.game.getWH=function(){return{w:m,h:n,w2:q,h2:r}};this.game.startLoop=function(a,b){this.setLoop(a);this.start(b)};this.game.start=cb;this.game.stop=db;this.game.resume=eb;var fb=[],gb=function(){for(var a in fb)if(typeof fb[a].draw=="function")fb[a].draw()},hb=function(a,b){b.prototype=Object.create(a.prototype);b.prototype.constructor=b},ib=function(a){this.type="BaseObject";this.x=a.x||0;this.y=a.y||0;this.w=a.w||5;this.h=a.h||5;this.fillColor=a.fillColor||false;this.strokeColor=a.strokeColor||v.strokeStyle;this.strokeWidth=a.strokeWidth||0;this.angle=a.angle||0;this.alpha=Ca(a.alpha)?a.alpha:1;this.center=z(0,0);this.visible=Ca(a.visible)?a.visible:true;this.flip=z(0,0);this.setShadow(a);if(a.userData)this.setUserData(a.userData);fb.push(this)};ib.prototype={getType:function(){return this.type},isArrIntersect:function(a){var b;for(b in a)if(a[b]!=this)if(this.isIntersect(a[b]))return a[b];return false},isArrInside:function(a){var b;for(b in a)if(this.isDynamicInside(a[b].getDynamicBox()))return true;return false},getNearest:function(a){var b=1,c=0,d=this.getDistanceC(a[c].getPosition(1)),e;for(;b<a.length;b++){e=this.getDistanceC(a[b].getPosition(1));if(e<d){d=e;c=b}}return a[c]},setFlip:function(a,b){this.flip.x=a||0;this.flip.y=b||0},setUserData:function(a){var b;for(b in a){if(Ca(this[b]))continue;this[b]=a[b]}},setShadow:function(a){this.shadowColor=a.shadowColor||false;this.shadowBlur=Ca(a.shadowBlur)?a.shadowBlur:3;this.shadowX=a.shadowX||0;this.shadowY=a.shadowY||0},getDynamicBox:function(){var a=this.getPosition(1);if(this.angle==0)return[z(this.x,this.y),z(this.x+this.w,this.y),z(this.x+this.w,this.y+this.h),z(this.x,this.y+this.h)];return[G(z(this.x,this.y),a,this.getAngle()),G(z(this.x+this.w,this.y),a,this.getAngle()),G(z(this.x+this.w,this.y+this.h),a,this.getAngle()),G(z(this.x,this.y+this.h),a,this.getAngle())]},isDynamicIntersect:function(a){if(a.length<3)return false;var b=this.getDynamicBox(),c;for(c=0;c<b.length;c++)if(I(b[c],a))return true;for(c=0;c<a.length;c++)if(I(a[c],b))return true;return false},isIntersect:function(a){return!this.angle&&!a.angle?this.isStaticIntersect(a.getStaticBox()):this.isDynamicIntersect(a.getDynamicBox())},isDynamicInside:function(a){if(a.length<3)return false;var b=this.getDynamicBox(),c,d=0;for(c=0;c<b.length;c++)if(I(b[c],a))d++;if(d==b.length)return true;return false},drawDynamicBox:function(a){Cb(this,1);U.shadowColor="transparent";Kb(z(this.x,this.y),z(this.w,this.h),false,a||"yellow",1);Bb()},drawStaticBox:function(a){U.shadowColor="transparent";Kb(z(this.x,this.y),z(this.w,this.h),false,a||"yellow",1)},isStaticIntersect:function(a){return this.y+this.h>=a.y&&this.x+this.w>=a.x&&(this.x<a.x+a.w&&this.y<a.y+a.h)},getStaticBox:function(){return{x:this.x,y:this.y,w:this.w,h:this.h}},setAlpha:function(a){if(this.alpha!=a)this.alpha=a>=0?a<=1?a:1:0},getAlpha:function(){return this.alpha},rotate:function(a){this.setAngle(Math.atan2(a.y-this.getPosition(1).y,a.x-this.getPosition(1).x)*(180/Math.PI))},setCenter:function(a){this.center=z(a.x,a.y)},getCenter:function(){return z(this.center.x,this.center.y)},move:function(a){this.prevPosition=this.getPosition();this.x+=a.x||0;this.y+=a.y||0},circling:function(a,b,c){if(!Ca(this.circlingAnglePointJS))this.circlingAnglePointJS=0;this.x=a.x+b*Math.cos(N(this.circlingAnglePointJS));this.y=a.y+b*Math.sin(N(this.circlingAnglePointJS));this.circlingAnglePointJS=this.circlingAnglePointJS>360?0:this.circlingAnglePointJS+c},circlingC:function(a,b,c){if(!Ca(this.circlingAnglePointJS))this.circlingAnglePointJS=0;this.setPositionC(z(a.x+b*Math.cos(N(this.circlingAnglePointJS)),a.y+b*Math.sin(N(this.circlingAnglePointJS))));this.circlingAnglePointJS=this.circlingAnglePointJS>360?0:this.circlingAnglePointJS+c},motion:function(a,b,c){if(!Ca(this.motionPercentPointJS))this.motionPercentPointJS=0;this.x=a.x+b.w*Math.cos(N(this.motionPercentPointJS));this.y=a.y+b.h*Math.sin(N(this.motionPercentPointJS));this.motionPercentPointJS=this.motionPercentPointJS>360?0:this.motionPercentPointJS+c},motionC:function(a,b,c){if(!Ca(this.motionPercentPointJS))this.motionPercentPointJS=0;this.setPositionC(z(a.x+b.w*Math.cos(N(this.motionPercentPointJS)),a.y+b.h*Math.sin(N(this.motionPercentPointJS))));this.motionPercentPointJS=this.motionPercentPointJS>360?0:this.motionPercentPointJS+c},scale:function(a){this.w+=a.w||0;this.h+=a.h||0},scaleC:function(a){this.scale(a);this.move(z(-(a.w/2),-(a.h/2)))},getPosition:function(a){if(a==1)return z(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y));else if(a==2){var b=z(this.x+this.w/2,this.y+this.h/2);if(this.angle)b=G(b,this.getPosition(1),this.angle);return z(b.x,b.y)}else return z(this.x,this.y)},setPosition:function(a){this.x=a.x&&a.x!=false?a.x:this.x;this.y=a.y&&a.y!=false?a.y:this.y},setPositionS:function(a){this.x=a.x&&a.x!=false?a.x+s.x:this.x;this.y=a.y&&a.y!=false?a.y+s.y:this.y},setPositionC:function(a){var b=this.w/2+this.center.x,c=this.h/2+this.center.y;this.x=a.x&&a.x!=false?-b+a.x:this.x;this.y=a.y&&a.y!=false?-c+a.y:this.y},setPositionCS:function(a){var b=this.w/2+this.center.x,c=this.h/2+this.center.y;this.x=a.x&&a.x!=false?-b+a.x+s.x:this.x;this.y=a.y&&a.y!=false?-c+a.y+s.y:this.y},getSize:function(){return A(this.w,this.h)},setSize:function(a){this.w=a.w?a.w:this.w;this.h=a.h?a.h:this.h},setSizeC:function(a){this.w=a.w?a.w:this.w;this.h=a.h?a.h:this.h;this.move(z(-(a.w/2),-(a.h/2)))},turn:function(a){this.angle=this.angle%360;this.angle+=a},rotateForAngle:function(a,b){var c=Math.abs(this.angle),d=Math.abs(a);if(c<90)if(this.angle<a)this.turn(b);else this.turn(-b);else{if(180-d<=b*2)this.setAngle(a);if(this.angle<a)this.turn(b);else this.turn(-b)}},moveAngle:function(a){this.prevPosition=this.getPosition();this.x+=a*Math.cos(N(this.angle));this.y+=a*Math.sin(N(this.angle))},moveTime:function(a,b){b=b||1;var c=this.getPosition();this.move(z((a.x-c.x)/b,(a.y-c.y)/b))},moveTimeC:function(a,b){b=b||1;var c=this.getPosition(1);this.move(z((a.x-c.x)/b,(a.y-c.y)/b))},getAngle:function(){return this.angle},setAngle:function(a){if(this.angle!=a)this.angle=a%360},getDistance:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(2).x,2)+Math.pow(a.y-this.getPosition(2).y,2))},getDistanceC:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(1).x,2)+Math.pow(a.y-this.getPosition(1).y,2))},setVisible:function(a){this.visible=a==true},isVisible:function(){return this.visible},isInCamera:function(){return this.angle?this.isInCameraDynamic():this.isInCameraStatic()},isInCameraStatic:function(){if(this.x+this.w<s.x||this.x>s.x+m)return false;if(this.y+this.h<s.y||this.y>s.y+n)return false;return true},isInCameraDynamic:function(){var a=this.getDynamicBox(),b=[z(s.x,s.y),z(s.x+m,s.y),z(s.x+m,s.y+n),z(s.x,s.y+n)],c,d=0;for(c=0;c<a.length;c++)if(I(a[c],b))d++;return d>0},onCollision:function(a){if(this.isIntersect(a)){if(!this.prevPosition)this.prevPosition=this.getPosition();var b=Math.abs(this.x-this.prevPosition.x);var c=Math.abs(this.y-this.prevPosition.y);var d=this.getPosition(2);var e=a.getPosition(2);if(d.x<e.x)this.move(z(-b,false));else this.move(z(b,false))}if(this.isIntersect(a))if(d.y<e.y)this.move(z(false,-c));else this.move(z(false,c))},onArrCollision:function(a){var b;for(b=0;b<a.length;b++)this.onCollision(a[b])},draw:function(){}};this.game.newBaseObject=function(a){return new ib(a)};var jb=function(a){ib.call(this,a);this.type="RectObject"};hb(ib,jb);jb.prototype.draw=function(){if(!this.visible)return;if(!this.alpha)return;var a=false;if(this.angle||this.alpha!=1){Cb(this);a=true}Kb(z(this.x,this.y),z(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth);if(a)Bb()};this.game.newRectObject=function(a){return new jb(a)};var kb=function(a){ib.call(this,a);this.radius=a.radius||5;this.w=this.radius*2;this.h=this.radius*2;this.type="CircleObject"};hb(ib,kb);kb.prototype.draw=function(){if(!this.visible)return;if(!this.alpha)return;var a=false;if(this.angle||this.alpha!=1){Cb(this);a=true}Mb(z(this.x,this.y),this.radius,this.fillColor,this.strokeColor,this.strokeWidth);if(a)Bb()};kb.prototype.scale=function(a){this.w+=a||0;this.h+=a||0;this.radius+=a/2||0;if(c==true)this.move(z(-(a/2),-(a/2)))};kb.prototype.scaleC=function(a){this.w+=a||0;this.h+=a||0;this.radius+=a/2||0;this.move(z(-(a/2),-(a/2)))};kb.prototype.getRadius=function(){return this.radius};kb.prototype.setRadius=function(a){if(!a||this.radius==a)return;this.radius=a;this.w=a*2;this.h=a*2};this.game.newCircleObject=function(a){return new kb(a)};var lb={},mb=function(a){this.file=a.file;this.w=a.w;this.h=a.h;this.countX=a.countX;this.countY=a.countY;this.fullW=this.countX*this.w;this.fullH=this.countY*this.h;this.cnv=window.document.createElement("canvas");this.cnv.width=this.w;this.cnv.height=this.h;this.ctx=this.cnv.getContext("2d");this.loaded=false;this.x=M(a.x);this.y=M(a.y);var b=window.document.createElement("img"),c=this;b.onload=function(){c.ctx.drawImage(this,0,0,c.w,c.h);c.loaded=true;bc.load()};b.src=this.file;bc.add()};mb.prototype.draw=function(){if(!this.loaded)return;var a=-s.x+this.x,b=-s.y+this.y,c,d;for(d=0;d<this.countY;d++){if(d*this.h+this.h<s.y||d*this.h>s.y+n)continue;for(c=0;c<this.countX;c++){if(c*this.w+this.w<s.x||c*this.w>s.x+m)continue;U.drawImage(this.cnv,a+c*this.w,b+d*this.h,this.w,this.h)}}};mb.prototype.getSize=function(){if(!this.loaded)return A();return A(this.fullW,this.fullH)};this.game.newBackgroundObject=function(a){return new mb(a)};var nb=function(a){ib.call(this,a);this.type="EllipsObject"};hb(ib,nb);nb.prototype.draw=function(){if(!this.visible)return;if(!this.alpha)return;Cb(this);Mb(z(this.x,this.y),this.h/2,this.fillColor,this.strokeColor,this.strokeWidth);Bb()};this.game.newEllipsObject=function(a){return new nb(a)};var ob=function(a){ib.call(this,a);this.type="TextObject";this.text=a.text||"TextObject";this.color=a.color||"";this.size=a.size||10;this.font=a.font||"sans-serif";this.style=a.style||"";this.align="left";this.padding=a.padding||2;this.w=pb(this.text,this.style,this.size,this.font)+this.padding*2;this.h=this.size+this.padding*2;this.strokeColorText=a.strokeColorText||false;this.strokeWidthText=a.strokeWidthText||false;this.textDY=-this.size/7};hb(ib,ob);ob.prototype.reStyle=function(a){this.text=a.text||this.text;this.color=a.color||this.color;this.size=a.size||this.size;this.font=a.font||this.font;this.style=a.style||this.style;this.padding=a.padding||this.padding;this.w=pb(this.text,this.style,this.size,this.font)+this.padding*2;this.h=this.size+this.padding*2;this.strokeColorText=a.strokeColorText||this.strokeColorText;this.strokeWidthText=a.strokeWidthText||this.strokeWidthText;this.strokeColor=a.strokeColor||this.strokeColor;this.strokeWidth=a.strokeWidth||this.strokeWidth;this.fillColor=a.fillColor||this.fillColor;this.textDY=-this.size/7};ob.prototype.setText=function(a){if(this.text==a)return;this.reStyle({text:a})};ob.prototype.getText=function(){return this.text};ob.prototype.draw=function(){if(!this.visible)return;if(!this.alpha)return;var a=false;if(this.angle||this.alpha!=1){Cb(this);a=true}if(this.fillColor||this.strokeColor)Kb(z(this.x,this.y),z(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth);Jb(z(this.x+this.padding,this.textDY+this.y+this.padding),this.text,this.color,this.size,this.font,this.style,this.align,this.strokeColorText,this.strokeWidthText);if(a)Bb()};ob.prototype.scale=function(a){this.reStyle({size:this.size+a})};ob.prototype.scaleC=function(a){this.reStyle({size:this.size+a});this.move(v2d(-a/2,-a/2))};ob.prototype.setSize=function(a){if(this.size==a)return;this.reStyle({size:a})};ob.prototype.setSizeC=function(a){if(this.size==a)return;this.reStyle({size:a});this.move(v2d(-a/2,-a/2))};var pb=function(a,b,c,d){var e=window.document.createElement("canvas").getContext("2d");e.font=b+c+"px "+d;return e.measureText(a).width};this.game.newTextObject=function(a){return new ob(a)};var qb=function(a){ib.call(this,a);this.type="PolygonObject";this.points=[];this.dY=0;this.dX=0;var b;if(a.points)for(b in a.points)this.addPoint(a.points[b]);this.pointColor=a.pointColor||false};hb(ib,qb);qb.prototype.addPoint=function(a){this.dX=0;this.dY=0;var b;if(this.y+a.y<this.y){this.dY=Math.abs(this.y+a.y-this.y);for(b in this.points)this.points[b].y+=this.dY}if(this.x+a.x<this.x){this.dX=Math.abs(this.x+a.x-this.x);for(b in this.points)this.points[b].x+=this.dX}this.points.push(z(a.x+this.dX,a.y+this.dY));this.w=0;this.h=0;for(b in this.points){this.h+=this.y+this.points[b].y>this.y+this.h?this.points[b].y-this.h:0;this.w+=this.x+this.points[b].x>this.x+this.w?this.points[b].x-this.w:0}};qb.prototype.delPoint=function(a){var b,c=this.getPoints();this.clearPoints();for(b=0;b<c.length;b++)if(b!=a)this.addPoint(c[b])};qb.prototype.clearPoints=function(){this.points=[];this.count=0};qb.prototype.getPoints=function(){return this.points};qb.prototype.getCount=function(){return this.points.length};qb.prototype.getPoint=function(a){return this.points[a]};qb.prototype.scale=function(a){return};qb.prototype.drawDynamicBox=function(a){var b=false;if(this.angle||this.alpha!=1){Cb(this);b=true}Hb(this.x,this.y,this.points,this.fillColor,a||"yellow",2,"red");if(b)Bb()};qb.prototype.getDynamicBox=function(){var a=[],b;if(!this.angle)for(b in this.points)a.push(B(this.points[b],z(this.x,this.y)));else{var c=this.getPosition(1);for(b in this.points)a.push(G(B(this.points[b],z(this.x,this.y)),c,this.getAngle()))}return a},qb.prototype.draw=function(){if(!this.visible)return;if(!this.alpha)return;var a=false;if(this.angle||this.alpha!=1){Cb(this);a=true}Hb(this.x,this.y,this.points,this.fillColor,this.strokeColor,this.strokeWidth,this.pointColor);if(a)Bb()};this.game.newPolygonObject=function(a){return new qb(a)};var rb=function(a){ib.call(this,a);this.type="ImageObject";if(a.w)this.w=a.w;else this.w=0;if(a.h)this.h=a.h;else this.h=0;this.loaded=false;this.file="";wb(a.file,this,a.scale||1)};hb(ib,rb);rb.prototype.draw=function(){if(!this.visible)return;if(!this.alpha)return;if(!this.loaded)return;var a=false;if(this.angle||this.alpha!=1||this.shadowColor){Cb(this);a=true}yb(z(this.x,this.y),A(this.w,this.h),this.file);if(a)Bb()};rb.prototype.simpleDraw=function(a){if(!this.loaded)return;var b=false;if(this.angle||this.alpha!=1){Cb(this);b=true}yb(z(a.x,a.y),A(this.w,this.h),this.file);if(b)Bb()};rb.prototype.setImage=function(a,b){if(this.file==a)return;if(!Ca(vb[a])){this.loaded=false;this.origWidth=0;this.origHeight=0;wb(a,this)}else this.file=a};rb.prototype.getImage=function(){return this.file};this.game.newImageObject=function(a){return new rb(a)};var sb=function(a){ib.call(this,a);this.type="AnimationObject";this.frame=0;this.anim=a.animation;this.step=a.delay||10;this.difStep=0};hb(ib,sb);sb.prototype.draw=function(){if(!this.visible)return;if(!this.alpha)return;var a=false;if(this.angle||this.alpha!=1||this.flip.x||this.flip.y){Cb(this);a=true}ub(this.anim,z(this.x,this.y),A(this.w,this.h),this.frame);if(this.difStep>this.step){this.frame=this.frame<this.anim.r?this.frame+1:0;this.difStep=0}else this.difStep++;if(a)Bb()};sb.prototype.drawFrames=function(a,b,c){if(!this.visible)return;if(!this.alpha)return;var d=false;if(this.angle||this.alpha!=1){Cb(this);d=true}ub(this.anim,z(this.x,this.y),A(this.w,this.h),this.frame);if(this.difStep>this.step){this.frame=this.frame<b?this.frame+1:a;this.difStep=0}else this.difStep++;if(d)Bb()};sb.prototype.drawFrame=function(a){if(!this.visible)return;if(!this.alpha)return;var b=false;if(this.angle||this.alpha!=1){Cb(this);b=true}ub(this.anim,z(this.x,this.y),A(this.w,this.h),a);if(b)Bb()};sb.prototype.setAnimation=function(a){this.anim=a};sb.prototype.getAnimation=function(){return this.anim};sb.prototype.setDelay=function(a){this.step=a>0?a:this.step};sb.prototype.getDelay=function(){return this.step};this.game.newAnimationObject=function(a){return new sb(a)};var tb=function(a){this.file=a;this.loaded=false;this.w=0;this.h=0;var b=window.document.createElement("img"),c=this;b.onload=function(){c.loaded=true;c.w=this.width;c.h=this.height;c.img=this;bc.load()};b.src=a;bc.add()};tb.prototype.getTile=function(a,b,c,d){return{image:this,x:a,y:b,w:c,h:d}};tb.prototype.getAnimation=function(a,b,c,d,e){return{image:this,x:a,y:b,w:c,h:d,r:e?e-1:0}};this.tiles.newImage=function(a){return new tb(a)};var ub=function(a,b,c,d){if(!a.image.loaded)return;var e=-s.x,f=-s.y;U.drawImage(a.image.img,a.x+a.w*d,a.y,a.w,a.h,b.x+e,b.y+f,c.w,c.h)},vb={},wb=function(a,b,c){if(Ca(vb[a])){b.loaded=true;b.file=a;return}var d=window.document.createElement("img");d.onload=function(){vb[a]={};vb[a].img=this;vb[a].w=this.width;vb[a].h=this.height;if(Ca(b)){b.loaded=true;if(!b.w)b.w=this.width*(c?c:1);if(!b.h)b.h=this.height*(c?c:1);b.file=a}bc.load()};d.src=a;bc.add()},xb=function(){return vb},yb=function(a,b,c){if(!c)return;var d=-s.x,e=-s.y;U.drawImage(vb[c].img,0,0,vb[c].w,vb[c].h,a.x+d,a.y+e,b.w,b.h)},zb=function(a){this.type="Mesh";this.objs=[];this.x=a.x||0;this.y=a.y||0;this.angle=a.angle||0;this.count=0;if(a.add){var b;for(b in a.add)this.add(a.add[b])}if(this.angle)this.setAngle(this.angle)};zb.prototype={getCount:function(){return this.count},add:function(a){this.count++;this.objs.push(a);a.offsetMesh=a.getPosition(1);a.turn(this.angle);a.setPositionC(z(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},del:function(a){var b;for(b in this.objs)if(this.objs[b]==a){this.objs.splice(b,1);this.count--}},draw:function(a){var b;for(b in this.objs)this.objs[b].draw()},move:function(a){this.x+=a.x||0;this.y+=a.y||0;var b,c;for(b in this.objs){c=this.objs[b];c.setPositionC(z(this.x+c.offsetMesh.x,this.y+c.offsetMesh.y))}},turn:function(a){if(a==0)return;this.angle=this.angle%360;this.angle+=a;var b,c,d=z(this.x,this.y);for(b in this.objs){c=this.objs[b];c.turn(a);c.setPositionC(G(z(this.x+c.offsetMesh.x,this.y+c.offsetMesh.y),d,this.angle))}},setAngle:function(a){if(a==this.angle)return;a=a%360;this.angle=a;var b,c,d=z(this.x,this.y);for(b in this.objs){c=this.objs[b];c.setAngle(a);c.setPositionC(G(z(this.x+c.offsetMesh.x,this.y+c.offsetMesh.y),d,this.angle))}},setPosition:function(a){if(this.x==a.x&&this.y==a.y)return;this.x=a.x||this.x;this.y=a.y||this.y;var b,c;for(b in this.objs){c=this.objs[b];if(!this.angle)c.setPositionC(z(this.x+c.offsetMesh.x,this.y+c.offsetMesh.y));else c.setPositionC(G(z(this.x+c.offsetMesh.x,this.y+c.offsetMesh.y),z(this.x,this.y),this.angle))}},isDynamicIntersect:function(a){if(a.length<3)return false;var b,c;for(b in this.objs){c=this.objs[b];if(c.isDynamicIntersect(a))return c}return false},isStaticIntersect:function(a){var b,c;for(b in this.objs){c=this.objs[b];if(c.isStaticIntersect(a))return c}return false}};this.game.newMesh=function(a){return new zb(a)};this.camera.move=function(a){s.x+=a.x||0;s.y+=a.y||0};this.camera.moveTime=function(a,b){b=b||1;var c=z(s.x,s.y);this.move(z((a.x-c.x)/b,(a.y-c.y)/b))};this.camera.moveTimeC=function(a,b){b=b||1;var c=z(s.x+q,s.y+r);this.move(z((a.x-c.x)/b,(a.y-c.y)/b))};this.camera.setPosition=function(a){var b=a.x?a.x:0,c=a.y?a.y:0;Ab(z(b,c))};this.camera.setPositionC=function(a){var b=a.x?a.x-q:0,c=a.y?a.y-r:0;Ab(z(b,c))};this.camera.getPosition=function(a){if(!a)return z(s.x,s.y);else z(s.x+q,s.y+r)};this.camera.getStaticBox=function(){return{x:s.x,y:s.y,w:s.x+m,h:s.y+n}};this.camera.getDynaminBox=function(){return[z(s.x,s.y),z(s.x+m,s.y),z(s.x+m,s.y+n),z(s.x,s.y+n)]};this.camera.turnCamera=function(a){t=t%360;t+=a};this.camera.setCameraAngle=function(a){t=a%360};var Ab=function(a){s=z(a.x,a.y)},Bb=function(a){U.restore();U.globalAlpha=v.globalAlpha},Cb=function(a,b){U.save();var c=a.getPosition(1);if(a.angle){U.translate(-s.x+c.x,-s.y+c.y);U.rotate(N(a.angle));U.translate(-c.x+s.x,-c.y+s.y)}if(a.alpha!=1)U.globalAlpha=a.alpha;if(a.flip.x||a.flip.y){U.translate(-s.x+c.x,-s.y+c.y);U.scale(a.flip.x?-1:1,a.flip.y?-1:1);U.translate(-c.x+s.x,-c.y+s.y)}if(a.shadowColor){U.shadowBlur=a.shadowBlur;U.shadowColor=a.shadowColor;U.shadowOffsetX=a.shadowX;U.shadowOffsetY=a.shadowY}if(a.type=="EllipsObject"&&!b){var d=a.w/2,e=a.h/2,f=z(-s.x+a.x,-s.y+a.y);U.translate(f.x,f.y);U.scale(d/e,1);U.translate(-f.x,-f.y)}};this.system.setContextSettings=function(a){U.save();for(var b in a)U[b]=a[b]};this.system.defaultSettings=function(){Bb()};var Db=function(a,b){U.clearRect(a.x,a.y,b.x,b.y)};this.game.clear=function(){Db(z(0,0),z(m,n))};var Eb=function(a){U.fillStyle=a||"white";U.fillRect(0,0,m,n)};this.game.fill=function(a){Eb(a)};var Fb=function(a,b){if(a.length<3)return;U.fillStyle=b;var c=-s.x,d=-s.y,e;U.beginPath();U.moveTo(c+a[0].x,d+a[0].y);for(e=1;e<a.length;e++)U.lineTo(c+a[e].x,d+a[e].y);U.closePath();U.fill()},Gb=function(a,b,c,d){if(c.length<3)return;U.fillStyle=d;var e=-s.x+a,f=-s.y+b,g;U.beginPath();U.moveTo(e+c[0].x,f+c[0].y);for(g=1;g<c.length;g++)U.lineTo(e+c[g].x,f+c[g].y);U.closePath();U.fill()},Hb=function(a,b,c,d,e,f,g){if(c.length<3)return;var h,i;if(d)Gb(a,b,c,d);for(h=0;h<c.length;h++){i=h+1<c.length?h+1:0;if(e)Nb(B(c[h],z(a,b)),B(c[i],z(a,b)),e,f);if(g)Lb(B(c[h],z(a,b)),g)}},Ib=function(a,b,c,d,e){if(a.length<3)return;var f,g;if(b)Fb(a,b);for(f=0;f<a.length;f++){g=f+1<a.length?f+1:0;if(c)Nb(a[f],a[g],c,d);if(e)Lb(a[f],e)}};this.brush.drawPolygon=function(a){Ib(a.points||[],a.fillColor||false,a.strokeColor||false,a.strokeWidth||1,a.pointColor||false)};var Jb=function(a,b,c,d,e,f,g,h,i){U.textAlign=g;U.lineWidth=i;U.font=(f?f+" ":"")+d+"px "+e;var j=-s.x,k=-s.y;if(c){U.fillStyle=c;U.fillText(b,j+a.x,k+a.y)}if(h){U.strokeStyle=h;U.strokeText(b,j+a.x,k+a.y)}};this.brush.drawText=function(a){Jb(z(a.x||0,a.y||0),a.text,a.color||false,a.size||10,a.font||v.font,a.style||false,a.align||"left",a.strokeColorText||false,a.strokeWidthText||2)};this.brush.drawTextS=function(a){Jb(z((a.x||0)+s.x,(a.y||0)+s.y),a.text,a.color||v.fillStyle,a.size||10,a.font||v.font,a.style||false,a.align||"left",a.strokeColor||false,a.strokeWidth||2)};this.brush.drawTextLines=function(a){if(!a.lines)return;var b;for(b=0;b<a.lines.length;b++)Jb(z(a.x,a.y+a.size*b),a.lines[b],a.color||v.fillStyle,a.size||10,a.font||v.font,a.style||false,a.align||"left",a.strokeColor||false,a.strokeWidth||2)};this.brush.drawTextLinesS=function(a){if(!a.lines)return;var b;for(b=0;b<a.lines.length;b++)Jb(z(a.x+s.x,a.y+s.y+a.size*b),a.lines[b],a.color||v.fillStyle,a.size||10,a.font||v.font,a.style||false,a.align||"left",a.strokeColor||false,a.strokeWidth||2)};var Kb=function(a,b,c,d,e){U.fillStyle=c;U.strokeStyle=d;U.lineWidth=e;var f=-s.x+(e?e/2:0),g=-s.y+(e?e/2:0);if(c)U.fillRect(a.x+f,a.y+g,b.x,b.y);if(e)U.strokeRect(a.x+f,a.y+g,b.x,b.y)};this.brush.drawRect=function(a){Kb(z(a.x,a.y),z(a.w,a.h),a.fillColor||false,a.strokeColor||v.strokeStyle,a.strokeWidth||false)};this.brush.drawRectS=function(a){Kb(z(a.x+s.x,a.y+s.y),z(a.w,a.h),a.fillColor||false,a.strokeColor||v.strokeStyle,a.strokeWidth||false)};var Lb=function(a,b){U.fillStyle=b;if(b)U.fillRect(-s.x+a.x-1,-s.y+a.y-1,2,2)};this.brush.drawPoint=function(a){Lb(z(a.x,a.y),a.fillColor||false)};this.brush.drawPointS=function(a){Lb(z(a.x+s.x,a.y+s.y),a.fillColor||false)};var Mb=function(a,b,c,d,e){U.fillStyle=c;U.strokeStyle=d;U.lineWidth=e;var f=-s.x+b+(e?e/2:0),g=-s.y+b+(e?e/2:0);U.beginPath();U.arc(a.x+f,a.y+g,b,0,Math.PI*2,true);U.closePath();if(c)U.fill();if(e)U.stroke()};this.brush.drawCircle=function(a){Mb(z(a.x,a.y),a.radius,a.fillColor||false,a.strokeColor||v.strokeStyle,a.strokeWidth||false)};this.brush.drawCircleS=function(a){Mb(z(a.x+s.x,a.y+s.y),a.radius,a.fillColor||false,a.strokeColor||v.strokeStyle,a.strokeWidth||false)};var Nb=function(a,b,c,d){U.strokeStyle=c;U.lineWidth=d;var e=-s.x+(d?d/2:0),f=-s.y+(d?d/2:0);U.beginPath();U.moveTo(e+a.x,f+a.y);U.lineTo(e+b.x,f+b.y);U.closePath();U.stroke()};this.brush.drawLine=function(a){Nb(z(a.x1,a.y1),z(a.x1+a.x2,a.y1+a.y2),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawLineS=function(a){Nb(z(s.x+a.x1,s.y+a.y1),z(s.x+a.x2,s.y+a.y2),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawLineA=function(a){Nb(z(a.x1,a.y1),z(a.x2,a.y2),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawEllips=function(a){var b=a.w/2,c=a.h/2,d=z(-s.x+a.x,-s.y+a.y);U.save();U.translate(d.x,d.y);U.scale(b/c,1);U.translate(-d.x,-d.y);Mb(z(a.x,a.y),c,a.fillColor,a.strokeColor,a.strokeWidth);U.restore()};this.brush.drawEllipsS=function(a){var b=a.w/2,c=a.h/2,d=z(a.x,a.y);U.save();U.translate(d.x,d.y);U.scale(b/c,1);U.translate(-d.x,-d.y);Mb(z(s.x+a.x,s.y+a.y),c,a.fillColor,a.strokeColor,a.strokeWidth);U.restore()};var Ob=function(a,b){var c=U.getImageData(a,b,1,1).data;return"rgb("+c[0]+", "+c[1]+", "+c[2]+")"},Pb=function(a,b,c){var d=U.createImageData(1,1);d.data[0]=c.r||d.data[0];d.data[1]=c.g||d.data[1];d.data[2]=c.b||d.data[2];d.data[3]=c.a||255;U.putImageData(d,a,b)},Qb=function(a,b,c){var d=U.getImageData(a,b,1,1),e={r:d.data[0],g:d.data[1],b:d.data[2],a:d.data[3]?d.data[3]:255};c(e);d.data[0]=e.r;d.data[1]=e.g;d.data[2]=e.b;d.data[3]=e.a;U.putImageData(d,a,b)},Rb=function(a,b,c,d,e){var f=U.getImageData(a,b,c,d),g,h;for(g=0,h=f.data.length;g<h;g+=4){var i={r:f.data[g],g:f.data[g+1],b:f.data[g+2],a:f.data[g+3]?f.data[g+3]:255};e(i);f.data[g]=i.r;f.data[g+1]=i.g;f.data[g+2]=i.b;f.data[g+3]=i.a}U.putImageData(f,a,b)},Sb=function(a,b,c,d,e){var f=U.getImageData(a,b,c,d);e(f.data,f.data.length);U.putImageData(f,a,b)};this.brush.getPixelColor=Ob;this.brush.setPixelColor=Pb;this.brush.onPixel=Qb;this.brush.onPixels=Rb;this.brush.onRawPixels=Sb;var Tb={},Ub=window.AudioContext||window.webkitAudioContext||false;Ub=Ub?new Ub:false;if(Ub)Ub.listener.setPosition(0,0,0);var Vb=function(a,b){if(!Ub)w('module "wAudio" is not supported! use a "audio"');this.vol=b&&b<=1&&b>0?b:1;this.playing=false;this.loaded=false;this.nextPlay=false;this.loadPLay=false;this.startTime=0;this.duration=0;this.pausedTime=0;var c=this,d=new XMLHttpRequest;d.open("GET",a,true);d.responseType="arraybuffer";d.onload=function(a){Ub.decodeAudioData(this.response,function(a){c.wABuffer=a;c.duration=c.wABuffer.duration;c.wAGain=Ub.createGain();c.wAGain.gain.value=c.vol;c.wAPanner=Ub.createPanner();c.wAPanner.setPosition(0,0,1);c.wAPanner.panningModel="equalpower";bc.load();c.loaded=true;if(c.loadPlay)c.replay()},function(a){w("Error decoding file",a)})};if(a)d.send();else w('Error "wAudio.newAudio". Where is file?');bc.add()};Vb.prototype.play=function(a){if(!this.loaded){this.loadPlay=true;return}if(this.playing)return;this.playing=true;this.wASource=Ub.createBufferSource();this.wASource.buffer=this.wABuffer;this.wAListener=Ub.destination;this.wASource.connect(this.wAGain);this.wAGain.connect(this.wAPanner);this.wAPanner.connect(this.wAListener);this.wASource.start(0,this.pausedTime,this.duration);this.startTime=Ub.currentTime;var b=this;this.wASource.onended=function(){b.playing=false;b.startTime=0;b.pausedTime=0;if(b.nextPlay)b.nextPlay.replay()}};Vb.prototype.replay=function(a){if(!this.loaded){this.loadPlay=true;return}this.stop();this.play()};Vb.prototype.stop=function(){this.pause();this.startTime=0;this.pausedTime=0};Vb.prototype.pause=function(){if(!this.playing)return;this.pausedTime=this.getProgress();this.playing=false;this.wASource.stop(0);var a=this;this.wASource.onended=function(){a.playing=false}};Vb.prototype.getProgress=function(){if(!this.playing)return this.pausedTime;return Ub.currentTime-this.startTime+this.pausedTime};Vb.prototype.playPause=function(){if(!this.playing)this.play();else this.pause()};Vb.prototype.setNextPlay=function(a){this.nextPlay=a};Vb.prototype.setVolume=function(a){this.vol=a&&a<=1&&a>0?a:this.vol;this.wAGain.gain.value=this.vol};Vb.prototype.getVolume=function(){return this.vol};Vb.prototype.setSide=function(a){this.side=a;if(!this.wAPanner)return;this.wAPanner.setPosition(this.side,0,1-Math.abs(this.side))};Vb.prototype.getSide=function(){return this.side};this.wAudio.newAudio=function(a,b){return new Vb(a,b)};var Wb={},Xb=function(a,b){var c,d,e=window.document.createElement("audio");if(typeof a=="string"){var f=window.document.createElement("source");f.src=a;e.appendChild(f)}else for(c=0,d=a.length;c<d;c++){var f=window.document.createElement("source");f.src=a[c];e.appendChild(f)}this.vol=b&&b<=1&&b>0?b:1;this.playing=0;this.audio=e;this.loaded=false;this.nextPlay=false;this.audio.volume=this.vol;var g=this;this.audio.onloadeddata=function(){g.loaded=true;bc.load()};this.audio.onended=function(){var a;g.playing=false;if(g.nextPlay)g.nextPlay.play()};this.audio.load();bc.add()};Xb.prototype.play=function(a){if(this.playing)return;if(a){this.vol=a&&a<=1&&a>0?a:this.vol;this.audio.volume=this.vol}this.playing=true;this.audio.play()};Xb.prototype.replay=function(a){if(a)this.setVolume(a);this.playing=true;this.audio.currentTime=0;this.audio.play()};Xb.prototype.stop=function(){if(!this.playing)return;this.playing=false;this.audio.pause();this.audio.currentTime=0};Xb.prototype.pause=function(){if(!this.playing)return;this.playing=false;this.audio.pause()};Xb.prototype.playPause=function(){if(!this.playing)this.play();else this.pause()};Xb.prototype.setNextPlay=function(a){this.nextPlay=a};Xb.prototype.setVolume=function(a){this.vol=a&&a<=1&&a>0?a:this.vol;this.audio.volume=this.vol};Xb.prototype.getVolume=function(){return this.vol};this.audio.newAudio=function(a,b){return new Xb(a,b)};var Yb=function(a,b,c){f.game.stop();f.touchControl.exitTouchControl();var d=window.document.createElement("input");d.type="text";d.style.position="fixed";d.style.border="none";d.style.zIndex=R.style.zIndex+1;d.style.outline="none";d.style.backgroundColor=a.fillColor||"white";d.style.color=a.color||"black";d.style.top=(a.y?M(a.y):0)+"px";d.style.left=(a.x?M(a.x):0)+"px";d.style.width=(a.w?M(a.w):0)+"px";d.style.fontSize=(a.size?M(a.size):10)+"px";var e=window.document.createElement("div");e.style.padding=(b.padding||10)+"px";e.align="center";e.style.position="fixed";e.style.border="none";e.style.zIndex=R.style.zIndex+1;e.style.backgroundColor=b.fillColor||"white";e.style.color=b.color||"black";e.innerHTML=b.text||"OK";e.style.top=(b.y?M(b.y):0)+"px";e.style.left=(b.x?M(b.x):0)+"px";if(b.w)e.style.width=M(b.w)+"px";if(b.h)e.style.height=M(b.h)+"px";e.style.fontSize=(b.size?M(b.size):10)+"px";e.addEventListener("touchstart",function(a){a.preventDefault();a.stopPropagation();f.touchControl.initTouchControl();var b=d.value.trim();if(typeof c=="function")c(b!=""?b:false);window.document.body.removeChild(d);window.document.body.removeChild(e);f.game.resume()},true);Q.attach(d);Q.attach(e);d.focus()},Zb=function(a,b){f.game.stop();var c=window.document.createElement("input");c.type="text";c.style.position="fixed";c.style.border="none";c.style.zIndex=R.style.zIndex+1;c.style.outline="none";c.style.backgroundColor=a.fillColor||"white";c.style.color=a.color||"black";c.style.top=(a.y?M(a.y):0)+"px";c.style.left=(a.x?M(a.x):0)+"px";c.style.width=(a.w?M(a.w):0)+"px";c.style.fontSize=(a.size?M(a.size):10)+"px";c.onkeydown=function(a){a.stopPropagation();if(a.keyCode==27||a.keyCode==13){var d=c.value.trim();if(typeof b=="function")b(d!=""?d:false);window.document.body.removeChild(c);f.game.resume()}};Q.attach(c);c.focus()},ac=function(a,b){f.game.stop();var c=window.document.createElement("textarea");c.style.position="fixed";c.style.border="none";c.style.zIndex=R.style.zIndex+1;c.style.overflowY="scroll";c.style.outline="none";c.style.backgroundColor=a.fillColor||"white";c.style.color=a.color||"black";c.style.top=(a.y?M(a.y):0)+"px";c.style.left=(a.x?M(a.x):0)+"px";c.style.width=(a.w?M(a.w):0)+"px";c.style.height=(a.h?M(a.h):0)+"px";c.style.fontSize=(a.size?M(a.size):10)+"px";c.style.maxWidth=(a.w?M(a.w):0)+"px";c.style.maxHeight=(a.h?M(a.h):0)+"px";c.onkeydown=function(a){a.stopPropagation();if(a.keyCode==27){var d=c.value.trim();if(typeof b=="function")b(d!=""?d:false);window.document.body.removeChild(c);f.game.resume()}};Q.attach(c);c.focus()};this.dialogs={openLine:Zb,openArea:ac,openTouchLine:Yb};var bc={count:0,loaded:0,errored:0,add:function(){this.count+=1},load:function(){this.loaded+=1},error:function(){this.errored+=1}},cc=function(){return bc.count==bc.loaded},dc=function(){return Math.ceil(bc.loaded/bc.count*100)};this.resources.isLoaded=cc;this.resources.getProgress=dc;var ec={fps:0,time:0,tmpFps:0},fc=function(){ec.tmpFps+=1;if(Na-ec.time>=1000){ec.fps=ec.tmpFps;ec.tmpFps=0;ec.time=Na}};this.system.initFPSCheck=function(){Q.addEvent("postLoop","fpsCheckUpdate",function(){fc()})};this.system.getFPS=function(){return ec.fps};window.onload=function(){for(var a in Q.events.onload)if(typeof Q.events.onload[a]=="function")Q.events.onload[a]();Q.loaded=true;var a;for(a in v)U[a]=v[a];return false};window.onblur=function(){if(!l)return;Q.runEvent("gameBlur");return false};window.onfocus=function(){if(l)return;Q.runEvent("gameFocus");return false};window.onresize=function(){Q.runEvent("gameResize");U.textBaseline=v.textBaseline;return false};window.onclick=function(){window.focus()}}